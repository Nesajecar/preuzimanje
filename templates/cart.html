<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Korpa</title>
    <script src="https://www.paypal.com/sdk/js?client-id=YOUR_SANDBOX_CLIENT_ID&currency=USD"></script>
</head>
<body>
    <h1>Vaša korpa</h1>

    <ul id="cart-items"></ul>
    <p>Ukupno: $<span id="total-price">0</span></p>

    <label>Email adresa za preuzimanje:</label><br>
    <input type="email" id="email" required><br><br>

    <div id="paypal-button-container"></div>

    <script>
        // >>> KONFIGURACIJA PROIZVODA <<<
        const products = {
            "template-1": { name: "Template 1", price: 10 },
            "template-2": { name: "Template 2", price: 15 },
            "template-3": { name: "Template 3", price: 20 },
            "template-9": { name: "Template 9", price: 25 }
        };

        const cart = JSON.parse(localStorage.getItem("cart")) || [];
        const cartItemsEl = document.getElementById("cart-items");
        const totalPriceEl = document.getElementById("total-price");
        let total = 0;

        if (cart.length === 0) {
            cartItemsEl.innerHTML = "<li>Korpa je prazna.</li>";
        } else {
            cart.forEach(itemId => {
                const item = products[itemId];
                if (item) {
                    const li = document.createElement("li");
                    li.textContent = `${item.name} - $${item.price}`;
                    cartItemsEl.appendChild(li);
                    total += item.price;
                }
            });
        }

        totalPriceEl.textContent = total.toFixed(2);

        // >>> PAYPAL INTEGRACIJA <<<
        paypal.Buttons({
            createOrder: function(data, actions) {
                return actions.order.create({
                    purchase_units: [{
                        amount: { value: total.toFixed(2) }
                    }]
                });
            },
            onApprove: function(data, actions) {
                return actions.order.capture().then(function(details) {
                    const email = document.getElementById("email").value;
                    if (!email) {
                        alert("Unesite email.");
                        return;
                    }

                    // >>> SLANJE PODATAKA BACKENDU <<<
                    fetch("/pay", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            email: email,
                            cart: cart
                        })
                    }).then(res => {
                        if (res.ok) {
                            localStorage.removeItem("cart"); // očisti korpu
                            window.location.href = `/success?email=${encodeURIComponent(email)}`;
                        } else {
                            alert("Greška prilikom slanja porudžbine.");
                        }
                    });
                });
            }
        }).render("#paypal-button-container");
    </script>
</body>
</html>

