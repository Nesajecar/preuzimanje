<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Checkout</title>
    <script src="https://www.paypal.com/sdk/js?client-id=YOUR_SANDBOX_CLIENT_ID&currency=USD"></script>
</head>
<body>
    <h1>Kupovina templejta</h1>

    <p>Template ID: {{ template_id }}</p>
    <p>Cena: ${{ price }}</p>

    <form id="pay-form">
        <label>Email adresa za preuzimanje:</label><br>
        <input type="email" name="email" required><br><br>
    </form>

    <div id="paypal-button-container"></div>

    <script>
        const price = "{{ price }}";

        paypal.Buttons({
            createOrder: function(data, actions) {
                return actions.order.create({
                    purchase_units: [{
                        amount: {
                            value: price
                        }
                    }]
                });
            },
            onApprove: function(data, actions) {
                return actions.order.capture().then(function(details) {
                    alert('Hvala, ' + details.payer.name.given_name + '!');

                    // Posalji POST ka serveru
                    fetch('/pay', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        body: `email=${document.querySelector('input[name=email]').value}&template_id={{ template_id }}`
                    }).then(res => {
                        if (res.ok) {
                            window.location.href = '/success?email=' + document.querySelector('input[name=email]').value;
                        } else {
                            alert('Došlo je do greške.');
                        }
                    });
                });
            }
        }).render('#paypal-button-container');
    </script>
</body>
</html>


<!--Drugi kod za tesitranje -->
<!--
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Checkout</title>
    <script src="https://www.paypal.com/sdk/js?client-id=YOUR_SANDBOX_CLIENT_ID&currency=USD"></script>
</head>
<body>

  <h1>Checkout</h1>

  <form action="{{ url_for('pay') }}" method="post">
       SKRIVENO polje koje nosi template_id 
      <input type="hidden" name="template_id" value="{{ template_id }}">

      <label for="email">Email adresa:</label>
      <input type="email" name="email" id="email" required>

      <button type="submit">Kupi</button>
  </form>

    <div id="paypal-button-container"></div>

    <script>
        const price = "{{ price }}";

        paypal.Buttons({
            createOrder: function(data, actions) {
                return actions.order.create({
                    purchase_units: [{
                        amount: {
                            value: price
                        }
                    }]
                });
            },
            onApprove: function(data, actions) {
                return actions.order.capture().then(function(details) {
                    alert('Hvala, ' + details.payer.name.given_name + '!');

                    // Posalji POST ka serveru
                    fetch('/pay', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        body: `email=${document.querySelector('input[name=email]').value}&template_id={{ template_id }}`
                    }).then(res => {
                        if (res.ok) {
                            window.location.href = '/success?email=' + document.querySelector('input[name=email]').value;
                        } else {
                            alert('Došlo je do greške.');
                        }
                    });
                });
            }
        }).render('#paypal-button-container');
    </script>
</body>
</html>
-->